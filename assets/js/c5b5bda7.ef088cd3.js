"use strict";(self.webpackChunkb_2_dvl_docs_site=self.webpackChunkb_2_dvl_docs_site||[]).push([[7541],{1356:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/dc-34843abcad2a5bb198953324ddb40d0d.png"},5982:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"tutorial/generate-vqa","title":"Generate VQAs","description":"Bench2Drive-VL integrates DriveCommenter to generate VQAs from static dataset or CARLA runtime. DriveCommenter is a rule-based model modified from the open-source annotation script of DriveLM-CARLA dataset. Different from DriveLM-CARLA annotating script, DriveCommenter","source":"@site/versioned_docs/version-0.0/tutorial/generate-vqa.md","sourceDirName":"tutorial","slug":"/tutorial/generate-vqa","permalink":"/Bench2Drive-VL/docs/tutorial/generate-vqa","draft":false,"unlisted":false,"tags":[],"version":"0.0","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Set Up the Environment","permalink":"/Bench2Drive-VL/docs/tutorial/set-up-env"},"next":{"title":"Closed-Loop Inference","permalink":"/Bench2Drive-VL/docs/tutorial/closed-loop-inference"}}');var i=n(4848),s=n(8453);const o={sidebar_position:2},a="Generate VQAs",c={},d=[{value:"Write a startup script",id:"write-a-startup-script",level:2},{value:"Start generating",id:"start-generating",level:2}];function l(e){const t={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"generate-vqas",children:"Generate VQAs"})}),"\n",(0,i.jsxs)(t.p,{children:["Bench2Drive-VL integrates DriveCommenter to generate VQAs from static dataset or CARLA runtime. DriveCommenter is a rule-based model modified from the open-source annotation script of ",(0,i.jsx)(t.a,{href:"https://github.com/OpenDriveLab/DriveLM/tree/DriveLM-CARLA",children:"DriveLM-CARLA dataset"}),". Different from DriveLM-CARLA annotating script, DriveCommenter"]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Eliminates reliance on expert model decision information."}),"\n",(0,i.jsx)(t.li,{children:"Optimizes problem structure by merging simple object-wise tasks into holistic problems, which helps reduce token usage."}),"\n",(0,i.jsx)(t.li,{children:"Incorporates objects outside the front-facing camera's field of view, which is especially important in scenarios such as overtaking or yielding to emergency vehicles."}),"\n",(0,i.jsx)(t.li,{children:"Expands the range of tasks to include environmental perception, high-level driving decision-making, and recognition of a broader set of traffic signs."}),"\n",(0,i.jsx)(t.li,{children:"Handles out-of-distribution (OOD) cases in non-expert routes to ensure the model can react to all sorts of situations in CARLA simulator."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"DriveCommenter Structure",src:n(1356).A+"",width:"4199",height:"1911"})}),"\n",(0,i.jsxs)(t.p,{children:["If you want to generate a VQA dataset from CARLA using DriveCommenter, set environment variable ",(0,i.jsx)(t.code,{children:"MINIMAL=0"})," to run closed-loop inference without VLMs can do this job. Please refer to ",(0,i.jsx)(t.a,{href:"/Bench2Drive-VL/docs/tutorial/closed-loop-inference",children:"closed-loop inference"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["If you want to know all supported questions of DriveCommenter and their qids, please refer to ",(0,i.jsx)(t.a,{href:"/Bench2Drive-VL/docs/references/supported-vqas",children:"qid reference"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["If you want to annotate VQAs from a dataset which has the same format as ",(0,i.jsx)(t.a,{href:"https://github.com/Thinklab-SJTU/Bench2Drive/blob/main/docs/anno.md",children:"Bench2Drive dataset"}),", please continue."]}),"\n",(0,i.jsxs)(t.admonition,{title:"Limitations",type:"danger",children:[(0,i.jsxs)(t.p,{children:["We ",(0,i.jsx)(t.strong,{children:"do not"})," recommend using DriveCommenter to annotate customized static dataset instead of annotating from CARLA directly."]}),(0,i.jsxs)(t.p,{children:["Since DriveCommenter is originally designed to annotate VQAs from Bench2Drive dataset, some rules in it are ",(0,i.jsx)(t.strong,{children:"only valid in Bench2Drive"}),". If the dataset is not from CARLA, or not from supported scenarios in Bench2Drive, the result ",(0,i.jsx)(t.strong,{children:"is not accurate"}),"."]})]}),"\n",(0,i.jsx)(t.h2,{id:"write-a-startup-script",children:"Write a startup script"}),"\n",(0,i.jsxs)(t.p,{children:["Place a startup script under ",(0,i.jsx)(t.code,{children:"./B2DVL-Adapter"}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",metastring:'title="B2DVL-Adapter/your_startup_script.sh"',children:"#!/bin/bash\nexport SUBSET=0 # generate from a subset of given dataset\nexport STRICT_MODE=1\n\nexport SUBSET_PATH=./subset_0.txt # subset file\nexport PROCESSED_PATH=./processed_paths_0.txt # checkpoint file\nexport CACHE_PATH=./.worker_0_cache\n\npython ./drive_commenter_main.py --data-directory=/path/to/Bench2Drive/dataset --output-graph-directory=./outgraph     --path-maps=${CARLA_ROOT}/CarlaUE4/Content/Carla/Maps     --worker-count=1\n"})}),"\n",(0,i.jsx)(t.admonition,{title:"Environment Variables",type:"info",children:(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"STRICT_MODE:"})," DriveCommenter drives the ego vehicle after circumventing obstacles back to its original lane and handle more out of distribution situations if ",(0,i.jsx)(t.code,{children:"STRICT_MODE > 0"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"CACHE_PATH:"})," DriveCommenter supports dataset in .tar.gz. It will unzip some of the dataset temporarily in cache directory."]}),"\n"]})}),"\n",(0,i.jsx)(t.admonition,{title:"Multi-thread Issues",type:"tip",children:(0,i.jsxs)(t.p,{children:["We do not recommend using multiple worker by ",(0,i.jsx)(t.code,{children:"--worker-count"})," since multi-thread in python is not very good. You can run multiple DriveCommenter at the same time with different subset and checkpoint files to do the same."]})}),"\n",(0,i.jsx)(t.h2,{id:"start-generating",children:"Start generating"}),"\n",(0,i.jsx)(t.p,{children:"Run the start up script."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:"cd ./B2DVL-Adapter\nbash ./your_startup_script.sh\n"})})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var r=n(6540);const i={},s=r.createContext(i);function o(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);